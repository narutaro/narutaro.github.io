<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en-us">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Connecting Svelte to Apollo | Yak Shaving</title>

<meta property='og:title' content='Connecting Svelte to Apollo - Yak Shaving'>
<meta property='og:description' content='Introduction Well, the weather has been so nice that I&rsquo;ve been neglecting it on the weekends while BBQing and making pizzas, but I think it&rsquo;s time to start working on the client side. Now that we&rsquo;ve got the server side working, let&rsquo;s make a client that connects to it.
Apollo&rsquo;s official website says that they don&rsquo;t know any client other than React, which is sad, but I&rsquo;ll try to make a TODO app client with Svelte.'>
<meta property='og:url' content='https://narutaro.github.io/post/connecting-svelte-to-apollo/'>
<meta property='og:site_name' content='Yak Shaving'>
<meta property='og:type' content='article'>
    <meta property='og:image' content='https://user-images.githubusercontent.com/4873581/123530762-06ac6080-d739-11eb-95ef-ff20b50de605.png'><meta property='article:author' content='https://facebook.com/x'><meta property='article:section' content='Post'><meta property='article:tag' content='graphql'><meta property='article:tag' content='apollo'><meta property='article:tag' content='svelte'><meta property='article:tag' content='javascript'><meta property='article:published_time' content='2021-07-22T14:55:30&#43;09:00'><meta property='article:modified_time' content='2021-07-22T14:55:30&#43;09:00'><meta name='twitter:card' content='summary'><meta name='twitter:site' content='@narutaro'><meta name='twitter:creator' content='@narutaro'>


<link href="https://narutaro.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Yak Shaving">

<link rel="stylesheet" href="/css/style.css"><link rel='stylesheet' href='https://narutaro.github.io/css/custom.css'><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://narutaro.github.io/post/connecting-svelte-to-apollo/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<script async src="https://www.googletagmanager.com/gtag/js?id=G-VG1JSZMTE8"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-VG1JSZMTE8', { 'anonymize_ip': false });
}
</script>

</head>
<body>

<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">

        <a id="nav-anchor" class="nav-item" href="https://narutaro.github.io/">

          
          <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
           width="74pt" height="46pt" viewBox="0 0 824 510"
           preserveAspectRatio="xMidYMid meet">
          <g transform="translate(0.000000,510.000000) scale(0.100000,-0.100000)" fill="currentColor" stroke="none">
          <path d="M2470 4639 c-305 -242 -565 -445 -577 -451 -15 -7 -67 -6 -187 6
          l-167 17 -62 -39 c-34 -22 -231 -151 -437 -288 -362 -239 -380 -250 -524 -306
          -82 -32 -152 -57 -157 -56 -4 2 31 98 78 213 l85 210 -58 373 c-39 249 -61
          364 -65 345 -4 -15 -24 -174 -45 -352 l-37 -324 -154 -248 c-84 -136 -153
          -252 -153 -259 0 -19 202 -350 214 -350 34 0 428 -50 436 -55 6 -3 10 -39 11
          -78 1 -40 4 -109 7 -154 l7 -82 174 -197 c96 -108 186 -210 199 -226 20 -24
          26 -46 34 -124 l9 -95 -87 -140 -87 -140 59 -162 60 -162 314 3 c173 1 347 5
          386 8 l72 6 58 84 c32 46 59 83 60 81 2 -1 57 -254 123 -562 66 -307 124 -562
          128 -565 5 -4 68 -22 140 -40 l133 -32 9 -37 c44 -166 49 -192 38 -197 -7 -2
          -570 -5 -1252 -7 l-1240 -2 -6 -65 c-4 -36 -6 -66 -5 -67 1 -2 839 -28 1862
          -59 l1859 -56 2075 51 c1141 28 2155 54 2253 58 l177 6 0 69 0 68 -276 0
          c-228 0 -275 2 -271 14 3 7 99 141 213 297 114 156 209 291 211 299 2 8 30
          226 63 483 l59 468 -181 657 c-99 361 -184 661 -188 665 -4 5 -252 112 -551
          238 -299 127 -555 237 -568 246 -13 8 -344 263 -734 566 -391 302 -722 554
          -736 559 -28 9 -2201 328 -2229 327 -9 0 -267 -198 -572 -440z m473 -309 l73
          -315 148 -224 148 -225 -23 -40 c-13 -23 -52 -90 -88 -150 l-66 -109 -365
          -118 c-201 -65 -371 -119 -379 -119 -7 0 -51 33 -96 73 -93 81 -89 71 -100
          247 l-6 95 398 68 c219 38 399 70 401 72 2 2 -35 84 -83 183 l-86 180 15 324
          c9 178 16 343 17 368 1 72 13 32 92 -310z m1072 -3580 c36 -146 68 -266 69
          -267 4 -5 304 -33 344 -33 l32 0 0 177 c0 98 4 173 9 168 4 -6 36 -82 71 -170
          35 -88 64 -161 64 -162 4 -7 359 -34 365 -27 4 5 37 89 72 187 42 117 66 171
          70 160 3 -10 12 -87 19 -171 10 -117 17 -155 28 -159 18 -7 704 57 715 66 4 4
          33 78 66 166 67 181 62 184 82 -47 8 -84 17 -138 23 -138 6 0 100 15 209 34
          l198 33 66 -81 c37 -45 73 -88 80 -97 11 -13 10 -25 -5 -70 l-19 -54 -1396 -3
          -1395 -2 -38 97 c-20 54 -43 113 -51 132 -7 19 -11 36 -9 38 2 2 54 -3 115
          -11 62 -9 118 -16 126 -16 13 0 15 38 15 262 0 144 2 259 4 257 3 -2 35 -123
          71 -269z m-928 -247 c110 -37 175 -63 177 -73 3 -8 8 -50 12 -92 l6 -78 -170
          0 -171 0 -6 33 c-33 194 -41 267 -28 267 4 0 85 -26 180 -57z m4192 -65 c36
          -28 69 -54 74 -58 4 -4 -4 -32 -18 -63 l-25 -57 -140 0 c-116 0 -140 2 -133
          14 23 39 159 215 167 216 4 0 38 -23 75 -52z"/>
          </g>
          </svg>

          
          <h1 id="nav-heading" class="blog-title">Yak Shaving</h1>

        </a>

      </div>
      <div class="nav-right">
        <nav id="nav-items" class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/narutaro'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="facebook" href='https://facebook.com/x'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="twitter" href='https://twitter.com/narutaro'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="instagram" href='https://instagram.com/x'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <rect x="2" y="2" width="20" height="20" rx="5" ry="5"/>
    <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/>
    <line x1="17.5" y1="6.5" x2="17.5" y2="6.5"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="email" href='mailto:x@gmail.com'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
    <polyline points="22,6 12,13 2,6"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="codepen" href='https://codepen.io/x'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <polygon points="12 2 22 8.5 22 15.5 12 22 2 15.5 2 8.5 12 2"/>
    <line x1="12" y1="22" x2="12" y2="15.5"/>
    <polyline points="22 8.5 12 15.5 2 8.5"/>
    <polyline points="2 15.5 12 8.5 22 15.5"/>
    <line x1="12" y1="2" x2="12" y2="8.5"/>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>


    <nav class="nav">
      

      
    </nav>

  </div>
  <script src="/js/navicon-shift.js"></script>
</section>

<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/graphql/">#graphql</a>



  
  | <a class="subtitle is-6" href="/tags/apollo/">#apollo</a>
  
  | <a class="subtitle is-6" href="/tags/svelte/">#svelte</a>
  
  | <a class="subtitle is-6" href="/tags/javascript/">#javascript</a>
  


      
    </div>
    <h2 class="subtitle is-6">July 22, 2021</h2>
    <h1 class="title">Connecting Svelte to Apollo</h1>
    
    <div class="content">
      <h1 id="introduction">Introduction</h1>
<p>Well, the weather has been so nice that I&rsquo;ve been neglecting it on the weekends while BBQing and making pizzas, but I think it&rsquo;s time to start working on the client side. Now that <a href="https://narutaro.github.io/posts/update-tasks-with-mutaions/">we&rsquo;ve got the server side working</a>, let&rsquo;s make a client that connects to it.</p>
<p>Apollo&rsquo;s official website says that they don&rsquo;t know any client other than React, which is sad, but I&rsquo;ll try to make a TODO app client with Svelte.</p>
<h1 id="tldr">TL;DR</h1>
<ul>
<li>I tried to run a GraphQL client with Svelte and Apollo.</li>
<li>You can do it with <code>@apollo/client</code>, but I found <a href="https://github.com/timhall/svelte-apollo"><code>svelte-apollo</code></a>, which is also introduced by Apollo, to be quite good. <code>svelte-apollo</code> is not well documented comparing to other ones, so I&rsquo;ll write what I wish it had.</li>
<li>Svelte recommends <a href="https://rollupjs.org/guide/en/"><code>rollup</code></a> as a task runner, and I&rsquo;ll write about what to watch out for in rollup.</li>
</ul>
<p>I think some parts of the readme are slightly wrong, maybe because the version of Apollo has been upgraded, but some parts don&rsquo;t work as is.</p>
<h1 id="lets-prepare-for-svelte-and-apollo-client">Let&rsquo;s prepare for Svelte and Apollo Client</h1>
<p>Here is my project structure</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">svelte-apollo-todo/
├── apollo 
└── svelte 
</code></pre></div><p>Installing Svelte&hellip;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">cd svelte-apollo-todo/
npx degit sveltejs/template svelte
cd svelte
npm install
</code></pre></div><p>and GraphQL&hellip;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">npm i --save @apollo/client graphql
</code></pre></div><h1 id="starting-apollo-and-svelte">Starting Apollo and Svelte</h1>
<ul>
<li>Start the Apollo server at <code>localhost:4000</code> with the <a href="https://narutaro.github.io/posts/update-tasks-with-mutaions/">code we created last time</a> by <code>node apollo-server.js</code></li>
<li>Start Svelte server at <code>localhost:5000</code> by <code>npm run dev</code></li>
</ul>
<p>Now, if you change <code>App.svelte</code> to the following, it will work for now. Here, <code>gql</code> interprets the syntax of GraphQL and turns it into a JS module.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">InMemoryCache</span>, <span style="color:#a6e22e">ApolloClient</span>, <span style="color:#a6e22e">gql</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@apollo/client&#39;</span>;

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">client</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ApolloClient</span>({
  <span style="color:#a6e22e">uri</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;http://localhost:4000&#39;</span>,
  <span style="color:#a6e22e">cache</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">InMemoryCache</span>()
});

<span style="color:#a6e22e">client</span>
  .<span style="color:#a6e22e">query</span>({
    <span style="color:#a6e22e">query</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">gql</span><span style="color:#e6db74">`
</span><span style="color:#e6db74">      query list {
</span><span style="color:#e6db74">        tasks {
</span><span style="color:#e6db74">          id
</span><span style="color:#e6db74">          name
</span><span style="color:#e6db74">          isActive
</span><span style="color:#e6db74">          createdAt
</span><span style="color:#e6db74">          updatedAt
</span><span style="color:#e6db74">          owner
</span><span style="color:#e6db74">        }
</span><span style="color:#e6db74">      }
</span><span style="color:#e6db74">    `</span>
  })
  .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">result</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">result</span>));
</code></pre></div><p>The respons is like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">{<span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> {<span style="color:#960050;background-color:#1e0010">…</span>}, <span style="color:#a6e22e">loading</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">networkStatus</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">7</span>}
  <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span>
    <span style="color:#a6e22e">tasks</span><span style="color:#f92672">:</span> Array(<span style="color:#ae81ff">4</span>)
        <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span> {<span style="color:#ae81ff">__</span><span style="color:#a6e22e">typename</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Task&#34;</span>, <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;1&#34;</span>, <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Soak in an Onsen&#34;</span>, <span style="color:#a6e22e">isActive</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">createdAt</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span>, <span style="color:#960050;background-color:#1e0010">…</span>}
        <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span> {<span style="color:#ae81ff">__</span><span style="color:#a6e22e">typename</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Task&#34;</span>, <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2&#34;</span>, <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Sing Karaoke&#34;</span>, <span style="color:#a6e22e">isActive</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">createdAt</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span>, <span style="color:#960050;background-color:#1e0010">…</span>}
        <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span> {<span style="color:#ae81ff">__</span><span style="color:#a6e22e">typename</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Task&#34;</span>, <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;3&#34;</span>, <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;See cherry blossom&#34;</span>, <span style="color:#a6e22e">isActive</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">createdAt</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span>, <span style="color:#960050;background-color:#1e0010">…</span>}
        <span style="color:#ae81ff">3</span><span style="color:#f92672">:</span> {<span style="color:#ae81ff">__</span><span style="color:#a6e22e">typename</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Task&#34;</span>, <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;4&#34;</span>, <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Buy some milk&#34;</span>, <span style="color:#a6e22e">isActive</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">createdAt</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1621812683</span>, <span style="color:#960050;background-color:#1e0010">…</span>}
    <span style="color:#a6e22e">length</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">4</span>
      <span style="color:#ae81ff">__</span><span style="color:#a6e22e">proto__</span><span style="color:#f92672">:</span> Array(<span style="color:#ae81ff">0</span>)
    <span style="color:#ae81ff">__</span><span style="color:#a6e22e">proto__</span><span style="color:#f92672">:</span> Object
  <span style="color:#a6e22e">loading</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>
  <span style="color:#a6e22e">networkStatus</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">7</span>
  <span style="color:#ae81ff">__</span><span style="color:#a6e22e">proto__</span><span style="color:#f92672">:</span> Object
</code></pre></div><p>At the top level of the response, there is <code>loading: false</code>, so I guess I can control whether it is loading or finished. Well, this way is fine, but I found <a href="https://github.com/timhall/svelte-apollo">svelte-apollo</a> which seems to make integration with Svelte easier, so I&rsquo;ll try that way.</p>
<h1 id="using-svelte-apollo">Using svelte-apollo</h1>
<p><a href="https://github.com/timhall/svelte-apollo">svelte-apollo</a> is Svelte integration for Apollo GraphQL.</p>
<p>Install</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">cd svelte
npm i --save svelte-apollo @rollup/plugin-graphql @rollup/plugin-replace
</code></pre></div><p><code>dependencies</code> in <code>package.json</code> at this point is like this.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">  <span style="color:#e6db74">&#34;dependencies&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
    <span style="color:#f92672">&#34;@apollo/client&#34;</span>: <span style="color:#e6db74">&#34;^3.3.19&#34;</span>,
    <span style="color:#f92672">&#34;@rollup/plugin-graphql&#34;</span>: <span style="color:#e6db74">&#34;^1.0.0&#34;</span>, <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">Use</span> <span style="color:#960050;background-color:#1e0010">this</span> <span style="color:#960050;background-color:#1e0010">loader</span>
    <span style="color:#f92672">&#34;graphql&#34;</span>: <span style="color:#e6db74">&#34;^15.5.0&#34;</span>, <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">Don&#39;t</span> <span style="color:#960050;background-color:#1e0010">use</span> <span style="color:#960050;background-color:#1e0010">this</span> <span style="color:#960050;background-color:#1e0010">anymore</span>
    <span style="color:#f92672">&#34;sirv-cli&#34;</span>: <span style="color:#e6db74">&#34;^1.0.0&#34;</span>,
    <span style="color:#f92672">&#34;svelte-apollo&#34;</span>: <span style="color:#e6db74">&#34;^0.4.0&#34;</span>
  }
</code></pre></div><p>Here&rsquo;s an <code>App.svelte</code> that does a whole bunch of operations on the GraphQL backend of TODO</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">InMemoryCache</span>, <span style="color:#a6e22e">ApolloClient</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@apollo/client&#39;</span>; <span style="color:#75715e">// ❶
</span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">setClient</span>, <span style="color:#a6e22e">query</span>, <span style="color:#a6e22e">mutation</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;svelte-apollo&#34;</span>; <span style="color:#75715e">// ❸
</span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">list_tasks</span>, <span style="color:#a6e22e">get_task</span>, <span style="color:#a6e22e">add_task</span>, <span style="color:#a6e22e">complete_task</span>, <span style="color:#a6e22e">delete_task</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./schema.graphql&#39;</span>; <span style="color:#75715e">// ❷
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">client</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ApolloClient</span>({
  <span style="color:#a6e22e">uri</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;http://localhost:4000&#39;</span>,
  <span style="color:#a6e22e">cache</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">InMemoryCache</span>()
});
<span style="color:#a6e22e">setClient</span>(<span style="color:#a6e22e">client</span>); <span style="color:#75715e">// ❸
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// list
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">listTasks</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> () =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">reply</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">query</span>(<span style="color:#a6e22e">list_tasks</span>);
  <span style="color:#a6e22e">reply</span>.<span style="color:#a6e22e">subscribe</span>(<span style="color:#a6e22e">data</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;list&#39;</span>, <span style="color:#a6e22e">data</span>)); <span style="color:#75715e">// ❹
</span><span style="color:#75715e"></span>};
<span style="color:#a6e22e">listTasks</span>();

<span style="color:#75715e">// getTask
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">getTask</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">tid</span>) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">reply</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">query</span>(<span style="color:#a6e22e">get_task</span>, { <span style="color:#a6e22e">variables</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tid</span> } });
  <span style="color:#a6e22e">reply</span>.<span style="color:#a6e22e">subscribe</span>(<span style="color:#a6e22e">data</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;get&#39;</span>, <span style="color:#a6e22e">data</span>));
};
<span style="color:#a6e22e">getTask</span>(<span style="color:#ae81ff">3</span>);

<span style="color:#75715e">// addTask
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">add</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mutation</span>(<span style="color:#a6e22e">add_task</span>);
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">addTask</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">tname</span>) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">reply</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">add</span>({ <span style="color:#a6e22e">variables</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tname</span> } }); <span style="color:#75715e">// ❺
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;add&#39;</span>, <span style="color:#a6e22e">reply</span>) 
};
<span style="color:#a6e22e">addTask</span>(<span style="color:#e6db74">&#39;New task&#39;</span>);

<span style="color:#75715e">// deleteTask
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">del</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mutation</span>(<span style="color:#a6e22e">delete_task</span>);
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">deleteTask</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">tid</span>) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">reply</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">del</span>({ <span style="color:#a6e22e">variables</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tid</span> } });
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;del&#39;</span>, <span style="color:#a6e22e">reply</span>) 
};
<span style="color:#a6e22e">deleteTask</span>(<span style="color:#ae81ff">5</span>);

<span style="color:#75715e">// completeTask
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">done</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mutation</span>(<span style="color:#a6e22e">complete_task</span>);
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">completeTask</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">tid</span>) =&gt; {
  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">reply</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">done</span>({ <span style="color:#a6e22e">variables</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tid</span> } });
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;done&#39;</span>, <span style="color:#a6e22e">reply</span>) <span style="color:#75715e">// ❻
</span><span style="color:#75715e"></span>};
<span style="color:#a6e22e">completeTask</span>(<span style="color:#ae81ff">10</span>);
</code></pre></div><p>Changes from using the Apollo client as-is:</p>
<ol>
<li>Use <a href="https://github.com/rollup/plugins/tree/master/packages/graphql">@rollup/plugin-graphql</a> to interpret GraphQL instead of the Apollo client&rsquo;s <code>gql</code> module. Interpret GraphQL (there are many implementations of this).</li>
<li>Load Query and Mutaion from <code>schema.graphql</code>. See below for the contents.</li>
<li>Import <code>svelte-apollo</code> and set the default client instance.</li>
<li>The return value of <code>query()</code> is <code>Stores</code> of Svelte wrapped with Promise, so use <code>subscribe()</code> to remove the contents. If you want to remove the contents, use <code>subscribe()</code>. You can see roughly what <code>Stores</code> does by looking at <a href="https://svelte.dev/tutorial/writable-stores">here</a>. In a word, it is an object that makes it easy to manage the state of multiple components.</li>
<li>Return value of Mutaion is not <code>Stores</code>.</li>
<li>Not the main topic, but it is easy to understand if you label it as <code>console.log('label', reply)</code>.</li>
</ol>
<p><code>schema.graphql</code> is as below.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">query</span> <span style="color:#a6e22e">list_tasks</span> {
  <span style="color:#a6e22e">tasks</span> {
    <span style="color:#a6e22e">id</span>
    <span style="color:#a6e22e">name</span>
    <span style="color:#a6e22e">isActive</span>
    <span style="color:#a6e22e">createdAt</span>
    <span style="color:#a6e22e">updatedAt</span>
    <span style="color:#a6e22e">owner</span>
  }
}

<span style="color:#a6e22e">query</span> <span style="color:#a6e22e">get_task</span>(<span style="color:#a6e22e">$id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ID</span><span style="color:#f92672">!</span>) {
  <span style="color:#a6e22e">task</span>(<span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">$id</span>) {
    <span style="color:#a6e22e">id</span>
    <span style="color:#a6e22e">name</span>
  }
}

<span style="color:#a6e22e">mutation</span> <span style="color:#a6e22e">add_task</span>(<span style="color:#a6e22e">$name</span><span style="color:#f92672">:</span> String<span style="color:#f92672">!</span>) {
  <span style="color:#a6e22e">addTask</span>(<span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">$name</span>) {
    <span style="color:#a6e22e">id</span>
    <span style="color:#a6e22e">name</span>
  }
}

<span style="color:#a6e22e">mutation</span> <span style="color:#a6e22e">complete_task</span>(<span style="color:#a6e22e">$id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ID</span><span style="color:#f92672">!</span>) {
  <span style="color:#a6e22e">completeTask</span>(<span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">$id</span>) {
    <span style="color:#a6e22e">id</span>
    <span style="color:#a6e22e">name</span>
    <span style="color:#a6e22e">isActive</span>
  }
}

<span style="color:#a6e22e">mutation</span> <span style="color:#a6e22e">delete_task</span>(<span style="color:#a6e22e">$id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ID</span><span style="color:#f92672">!</span>) {
  <span style="color:#a6e22e">deleteTask</span>(<span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">$id</span>) {
    <span style="color:#a6e22e">id</span>
    <span style="color:#a6e22e">name</span>
  }
}
</code></pre></div><p>Corresponging <code>reply</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">list</span> {<span style="color:#a6e22e">loading</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> {<span style="color:#960050;background-color:#1e0010">…</span>}, <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">undefined</span>}
  <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span>
    <span style="color:#a6e22e">tasks</span><span style="color:#f92672">:</span> Array(<span style="color:#ae81ff">4</span>)
      <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span> {<span style="color:#ae81ff">__</span><span style="color:#a6e22e">typename</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Task&#34;</span>, <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;1&#34;</span>, <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Soak in an Onsen&#34;</span>, <span style="color:#a6e22e">isActive</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">createdAt</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span>, <span style="color:#960050;background-color:#1e0010">…</span>}
      <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span> {<span style="color:#ae81ff">__</span><span style="color:#a6e22e">typename</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Task&#34;</span>, <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2&#34;</span>, <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Sing Karaoke&#34;</span>, <span style="color:#a6e22e">isActive</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">createdAt</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span>, <span style="color:#960050;background-color:#1e0010">…</span>}
      <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span> {<span style="color:#ae81ff">__</span><span style="color:#a6e22e">typename</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Task&#34;</span>, <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;3&#34;</span>, <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;See cherry blossom&#34;</span>, <span style="color:#a6e22e">isActive</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">createdAt</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span>, <span style="color:#960050;background-color:#1e0010">…</span>}
      <span style="color:#ae81ff">3</span><span style="color:#f92672">:</span> {<span style="color:#ae81ff">__</span><span style="color:#a6e22e">typename</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Task&#34;</span>, <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;4&#34;</span>, <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Buy some milk&#34;</span>, <span style="color:#a6e22e">isActive</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">createdAt</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1621812683</span>, <span style="color:#960050;background-color:#1e0010">…</span>}
      <span style="color:#a6e22e">length</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">4</span>
      <span style="color:#ae81ff">__</span><span style="color:#a6e22e">proto__</span><span style="color:#f92672">:</span> Array(<span style="color:#ae81ff">0</span>)
    <span style="color:#ae81ff">__</span><span style="color:#a6e22e">proto__</span><span style="color:#f92672">:</span> Object
  <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">undefined</span>
  <span style="color:#a6e22e">loading</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>
  <span style="color:#ae81ff">__</span><span style="color:#a6e22e">proto__</span><span style="color:#f92672">:</span> Object
</code></pre></div><p>The above is a <code>console.log()</code> to look into the contents of the object, but in reality, the Svelte way is to handle it as follows. It&rsquo;s nice and clean.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">reply</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">query</span>(<span style="color:#a6e22e">list_tasks</span>);

{<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">$reply</span>.<span style="color:#a6e22e">loading</span>}
  <span style="color:#a6e22e">Loading</span>...
{<span style="color:#f92672">:</span><span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">$reply</span>.<span style="color:#a6e22e">error</span>}
  Error<span style="color:#f92672">:</span> {<span style="color:#a6e22e">$reply</span>.<span style="color:#a6e22e">error</span>.<span style="color:#a6e22e">message</span>}
{<span style="color:#f92672">:</span><span style="color:#66d9ef">else</span>}
  {<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">each</span> <span style="color:#a6e22e">$reply</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">tasks</span> <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">task</span>}
    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">p</span><span style="color:#f92672">&gt;</span>{<span style="color:#a6e22e">task</span>.<span style="color:#a6e22e">id</span>} {<span style="color:#a6e22e">task</span>.<span style="color:#a6e22e">name</span>}<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/p&gt;</span>
  {<span style="color:#960050;background-color:#1e0010">/each}</span>
{<span style="color:#960050;background-color:#1e0010">/if}</span>
</code></pre></div><p>You can now do CRUD with GraphQL. Now we just need to tweak the HTML side of <code>App.svelte</code>.</p>
<h1 id="rollup-error-collection">Rollup error collection</h1>
<p>Since I am a beginner, Rollup-sensei gave me a few scolding.</p>
<h2 id="error-1">Error 1</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">bundle.js:5019 Uncaught ReferenceError: process is not defined
    at new ApolloClient <span style="color:#f92672">(</span>bundle.js:5019<span style="color:#f92672">)</span>
</code></pre></div><p>This is not passing environment variables properly. The following  <a href="https://github.com/rollup/plugins/tree/master/packages/replace">@rollup/plugin-replace</a> solves it.</p>
<p><code>rollup.config.js</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">    <span style="color:#a6e22e">replace</span>({
      <span style="color:#e6db74">&#39;process.env.NODE_ENV&#39;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>( <span style="color:#e6db74">&#39;development&#39;</span> )
    }),
</code></pre></div><h2 id="error-2">Error 2</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">Error: Unexpected token <span style="color:#f92672">(</span>Note that you need plugins to import files that are not JavaScript<span style="color:#f92672">)</span>
</code></pre></div><p>GraphQL is not being interpreted. Solved with <a href="https://github.com/rollup/plugins/tree/master/packages/graphq">@rollup/plugin-graphql</a></p>
<h2 id="error-3">Error 3</h2>
<p>This is not a rollup, but an Apollo error. <code>cache</code> is required.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">Uncaught Invariant Violation: To initialize Apollo Client, you must specify a <span style="color:#e6db74">&#39;cache&#39;</span> property in the options object. 
</code></pre></div><h2 id="error-4">Error 4</h2>
<p>What kind of error was this? I don&rsquo;t think it had anything to do with the execution.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">Exception: TypeError: <span style="color:#e6db74">&#39;caller&#39;</span>, <span style="color:#e6db74">&#39;callee&#39;</span>, and <span style="color:#e6db74">&#39;arguments&#39;</span> properties may not be accessed on strict mode functions or the arguments objects <span style="color:#66d9ef">for</span> ca
</code></pre></div><h1 id="next-step">Next step</h1>
<p>For some more study, let&rsquo;s replace <a href="https://zenn.dev/masaino/articles/a3b0eb46fd54f0">TODO application written in REST</a> with GraphQL before!</p>

      
      <div class="related">

<h3>Similar articles:</h3>
<ul>
	
	<li><a href="/posts/update-tasks-with-mutaions/">Update Tasks with Mutaions</a></li>
	
	<li><a href="/posts/search-an-item-with-apollo/">Query to Search for an Item with Apollo</a></li>
	
	<li><a href="/posts/lets-review-all-the-settings/">Simple list view with Apollo</a></li>
	
</ul>

</div>
      
    </div>
    
  </div>
</section>



<section class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="https://github.com/narutaro">narutaro</a> 2021</p>
    
      <p>Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/ribice/kiss">Kiss</a> with tweaks.</p>
    
  </div>
</section>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-VG1JSZMTE8', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>





<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:'2474705',hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>

</body>
</html>

